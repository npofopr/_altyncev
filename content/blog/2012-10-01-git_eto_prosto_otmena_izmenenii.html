---
title: "Git это просто. Запись №2. Отмена изменений"
description: "На любой стадии может возникнуть необходимость что-либо отменить. Здесь мы рассмотрим несколько основных инструментов для отмены произведённых изменений. Будьте осторожны, ибо не всегда можно отменить сами отмены."
tags: ["git"]
categories: ["git"]
date: "2012-10-01"
---

<p>На любой стадии может возникнуть необходимость что-либо отменить. Здесь мы рассмотрим несколько основных инструментов для отмены произведённых изменений. Будьте осторожны, ибо не всегда можно отменить сами отмены.</p>

<!-- Read more -->

<p><span style="text-decoration: underline;"><strong>Изменение последнего коммита</strong></span></p>
<p>Одна из типичных отмен происходит тогда, когда вы делаете коммит слишком рано, забыв добавить какие-то файлы, или напутали с комментарием к коммиту. Если вам хотелось бы сделать этот коммит ещё раз, вы можете выполнить commit с опцией --amend:</p>
<pre title="Изменение последнего коммита">$ git commit --amend</pre>
<p>&nbsp;Для примера, если после совершения коммита вы осознали, что забыли проиндексировать изменения в файле, которые хотели добавить в этот коммит, вы можете сделать что-то подобное:</p>
<pre>$ git commit -m 'initial commit'
$ git add forgotten_file
$ git commit --amend</pre>
<p>&nbsp;Все три команды вместе дают один коммит &mdash; второй коммит заменяет результат первого.</p>
<p><span style="text-decoration: underline;"><strong>Отмена индексации файла</strong></span></p>
<p>Допустим, вы внесли изменения в два файла и хотите записать их как два отдельных коммита, но случайно набрали git add * и проиндексировали оба файла. Как теперь отменить индексацию одного из двух файлов? Команда git status напомнит вам об этом:</p>
<p>Сразу после надписи &laquo;Changes to be committed&raquo;, написано использовать git reset HEAD <file>... для исключения из индекса. Так что давайте последуем совету и отменим индексацию файла benchmarks.rb:</p>
<pre>$ git reset HEAD benchmarks.rb
benchmarks.rb: locally modified
$ git status
# On branch master
# Changes to be committed:
# (use "git reset HEAD <file>..." to unstage)
#
# modified: README.txt
#
# Changed but not updated:
# (use "git add <file>..." to update what will be committed)
# (use "git checkout -- <file>..." to discard changes in working directory)
#
# modified: benchmarks.rb
#</pre>
<p><span style="text-decoration: underline;"><strong>Отмена изменений файла</strong></span></p>
<p>Что, если вы поняли, что не хотите оставлять изменения, внесённые в файл benchmarks.rb?<br /> Как быстро отменить изменения, вернуть то состояние, в котором он находился во время последнего коммита (или первоначального клонирования, или какого-то другого действия, после которого файл попал в рабочий каталог)? К счастью, git status говорит, как добиться и этого. В выводе для последнего примера, неиндексированная область выглядит следующим образом:</p>
<pre># Changed but not updated:
# (use "git add <file>..." to update what will be committed)
# (use "git checkout -- <file>..." to discard changes in working directory)
#
# modified: benchmarks.rb
#</pre>
<p>Здесь довольно ясно сказано, как отменить сделанные изменения (по крайней мере новые версии Git&rsquo;а, начиная с 1.6.1, делают это; если у вас версия старее, мы настоятельно рекомендуем обновиться, чтобы получать такие подсказки и сделать свою работу удобней). Давайте сделаем то, что написано:</p>
<pre>$ git checkout -- benchmarks.rb
$ git status
# On branch master
# Changes to be committed:
# (use "git reset HEAD <file>..." to unstage)
#
# modified: README.txt
#</pre>
<p>Вы должны понимать, что это опасная команда:</p>
<p>Все сделанные вами изменения в этом файле пропали &mdash; вы просто скопировали поверх него другой файл. Никогда не используйте эту команду, если вы не полностью уверены, что этот файл вам не нужен. Если вам нужно просто сделать, чтобы он не мешался, мы рассмотрим прятание (stash) и ветвление в следующей главе; эти способы обычно более предпочтительны.</p>
<p>Помните, что всё, что является частью коммита в Git, почти всегда может быть восстановлено. Даже коммиты, которые находятся на ветках, которые были удалены, и коммиты переписанные с помощью --amend могут быть восстановлены.</p>
<p>Несмотря на это, всё, что никогда не попадало в коммит, вы скорее всего уже не увидите снова.</p>
<p>&nbsp;</p>
<p>The End #2</p>
